<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NEXUS v10 | Ultimate Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1e90ff; --accent: #4da6ff; --bg: #050505; --glass: rgba(15, 15, 20, 0.7); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Geist', sans-serif; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; }
        .video-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; opacity: 0.3; }
        
        #auth-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(15px); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .auth-box { background: var(--glass); border: 1px solid var(--primary); padding: 40px; border-radius: 20px; width: 380px; text-align: center; }
        
        #app-screen { display: flex; height: 100%; }
        .sidebar { width: 260px; background: var(--glass); border-right: 1px solid rgba(255,255,255,0.1); padding: 20px; display: flex; flex-direction: column; }
        .main { flex: 1; padding: 30px; overflow-y: auto; }
        .card { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 25px; margin-bottom: 20px; }
        
        input, textarea { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid #333; color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; outline: none; }
        .btn { width: 100%; padding: 12px; border-radius: 50px; border: none; cursor: pointer; font-weight: 700; text-transform: uppercase; transition: 0.3s; color: white; background: var(--primary); }
        .hidden { display: none !important; }
        
        .proc-item { background: rgba(0,0,0,0.6); padding: 15px; border-radius: 10px; border-left: 4px solid var(--primary); margin-bottom: 10px; }
        .proc-logs { height: 100px; overflow-y: auto; background: #000; padding: 8px; font-family: monospace; font-size: 11px; color: #0f0; }
    </style>
</head>
<body>
    <video autoplay loop muted playsinline class="video-bg"><source src="https://res.cloudinary.com/dwzczbbpr/video/upload/Violet_Dark_Blue_White_Anime_Music_Twitch_Background_1_et0ilf.mp4" type="video/mp4"></video>

    <div id="auth-screen">
        <div class="auth-box">
            <h2>NEXUS LOGIN</h2>
            <input type="text" id="l-user" placeholder="Username">
            <input type="password" id="l-pass" placeholder="Password">
            <button class="btn" onclick="auth('login')">LOGIN</button>
            <button class="btn" style="background:transparent; border:1px solid var(--primary); margin-top:10px" onclick="auth('register')">REGISTER</button>
        </div>
    </div>

    <div id="app-screen" class="hidden">
        <div class="sidebar">
            <div style="font-size:1.5rem; font-weight:800; margin-bottom:40px"><i class="fas fa-bolt"></i> NEXUS v10</div>
            <div style="margin-top:auto">
                <button class="btn" onclick="logout()">LOGOUT</button>
                <div id="u-display" style="padding:10px; font-size:12px; color:var(--primary)">User: ...</div>
            </div>
        </div>
        <div class="main">
            <div class="grid-2" style="display:grid; grid-template-columns: 350px 1fr; gap:25px">
                <div class="card">
                    <h3><i class="fas fa-plus-circle"></i> KHỞI TẠO</h3>
                    <textarea id="tokens" placeholder="Tokens (Mỗi dòng 1 cái)..."></textarea>
                    <textarea id="channels" rows="2" placeholder="ID Kênh (123, 456...)"></textarea>
                    <textarea id="message" rows="2" placeholder="Nội dung tin nhắn..."></textarea>
                    <input type="number" id="delay" value="5" placeholder="Delay (s)">
                    <button class="btn" onclick="start()">CHẠY NGAY</button>
                </div>
                <div class="card">
                    <h3><i class="fas fa-server"></i> TIẾN TRÌNH CỦA BẠN</h3>
                    <div id="list"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let TOKEN = localStorage.getItem('nx_token');
        if(TOKEN) showApp();

        async function auth(type) {
            const u = document.getElementById('l-user').value;
            const p = document.getElementById('l-pass').value;
            const res = await fetch(`/api/${type}`, {
                method: 'POST', headers: {'Content-Type':'application/json'},
                body: JSON.stringify({username: u, password: p})
            });
            const data = await res.json();
            if(data.success) {
                if(type === 'login') {
                    localStorage.setItem('nx_token', data.token);
                    localStorage.setItem('nx_user', data.username);
                    location.reload();
                } else alert(data.msg);
            } else alert(data.msg);
        }

        function showApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('app-screen').classList.remove('hidden');
            document.getElementById('u-display').innerText = "User: " + localStorage.getItem('nx_user');
            setInterval(fetchData, 1500);
        }

        function logout() { localStorage.clear(); location.reload(); }

        async function start() {
            const body = {
                tokens: document.getElementById('tokens').value,
                channels: document.getElementById('channels').value,
                message: document.getElementById('message').value,
                delay: Number(document.getElementById('delay').value),
                count: 0, proxy: ""
            };
            const res = await fetch('/api/start', {
                method: 'POST', headers: {'Content-Type':'application/json', 'Authorization': `Bearer ${localStorage.getItem('nx_token')}`},
                body: JSON.stringify(body)
            });
            const data = await res.json();
            if(data.success) { alert(data.msg); document.getElementById('tokens').value = ''; }
        }

        async function fetchData() {
            const res = await fetch('/api/status', { headers: { 'Authorization': `Bearer ${localStorage.getItem('nx_token')}` } });
            if(res.status === 403) logout();
            const data = await res.json();
            render(data);
        }

        function render(data) {
            const list = document.getElementById('list');
            list.innerHTML = data.map(p => `
                <div class="proc-item" style="border-color:${p.running?'#0f0':'#f44'}">
                    <div style="display:flex; justify-content:space-between; font-weight:bold;">
                        <span><i class="fas fa-key"></i> ${p.mask}</span>
                        <button onclick="control('delete', '${p.id}')" style="background:none; border:none; color:#f44; cursor:pointer;">❌</button>
                    </div>
                    <div style="font-size:12px; color:#aaa; margin-top:5px">Sent: ${p.stats.sent} | Fail: ${p.stats.fail}</div>
                    <div class="proc-logs">${p.logs.map(l => `<div>[${l.time}] ${l.msg}</div>`).reverse().join('')}</div>
                </div>
            `).join('');
        }

        async function control(action, id) {
            await fetch('/api/control', {
                method: 'POST', headers: {'Content-Type':'application/json', 'Authorization': `Bearer ${localStorage.getItem('nx_token')}`},
                body: JSON.stringify({ action, id })
            });
        }
    </script>
</body>
</html>
